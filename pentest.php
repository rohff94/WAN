<?php

include "./core/0.all.inc.php";


/*
 
  docker-compose down && docker rm $(docker ps -a -q)
  
   
  
  
  
 */


$exec = new DATA();


##############################################################################



if ( $argc != 3 ) {echo "Usage: ".__FILE__." 'SERVICE' 'PARAMS' ";exit(0);}

$service = strtoupper(trim($argv[1])) ;
$exec->start("Pentest", $service);

$stream = "";
$flag_poc = FALSE ;

switch ($service){
    
    case "DOMAIN" :
        //wget https://raw.githubusercontent.com/disclose/disclose/master/program-list/program-list.json -O /tmp/program-list.json
        //cat /tmp/program-list.json | grep http | cut -d':' -f3 | sed "s#//##g" | sed "s#bugcrowd.com/##g" | sed "s#hackerone.com/##g" | cut -d'/' -f1 | sort -u | grep -Po -i "[0-9a-z_\-]{1,}\.[a-z]{2,5}$" | sort -u > /tmp/bounty.bugs
        
        // for i in $(cat /home/rohff/EH/CODE/POO/TMP/bounty.bugs); do echo "wlp5s0 $i domain4service FALSE" >> /home/rohff/EH/CODE/POO/TMP/bounty.bugs.donain4service ; done
        
        //for i in $(tail -370 /home/rohff/EH/CODE/POO/TMP/bounty.bugs); do php pentest.php DOMAIN "wlp5s0 $i domain4info FALSE";done
        //for i in $(cat /home/rohff/EH/CODE/POO/TMP/bounty.bugs); do php pentest.php DOMAIN "wlp5s0 $i domain4service FALSE";done
        // cat /home/rohff/EH/CODE/POO/TMP/bounty.bugs.donain4service | parallel --progress -k -j8 php pentest.php DOMAIN "{}"
        // tac /home/rohff/EH/CODE/POO/TMP/bounty.bugs.donain4service | parallel --progress -k -j8 php pentest.php DOMAIN "{}"
        // head -20 /home/rohff/EH/CODE/POO/TMP/bounty.bugs.donain4service | parallel --progress -k -j8 php pentest.php DOMAIN "{}"
        // tail -70 /home/rohff/EH/CODE/POO/TMP/bounty.bugs.donain4service | parallel --progress -k -j8 php pentest.php DOMAIN "{}"
        //for i in $(head -30 /home/rohff/EH/CODE/POO/TMP/bounty.bugs); do php pentest.php DOMAIN "wlp5s0 $i domain4info FALSE";done
        //for i in $(tail -30 /home/rohff/EH/CODE/POO/TMP/bounty.bugs); do php pentest.php DOMAIN "wlp5s0 $i domain4service FALSE";done
        

        
        // head -310 /home/rohff/EH/CODE/POO/TMP/bounty.bugs.donain4service | tail -70 | sed "s/domain4service/domain4info/g" | parallel --progress -k -j8 php pentest.php DOMAIN "{}"
        //for i in $(cat /home/rohff/EH/CODE/POO/TMP/bounty.bugs); do php pentest.php DOMAIN "wlp5s0 $i domain4pentest FALSE";done
        
        //   domain4info
        //cd /home/rohff/WAN ; for i in $(cat /home/rohff/bounty.bugs); do php pentest.php DOMAIN "ens3 $i domain4info FALSE";done
        
        //cd /home/rohff/WAN ; for i in $(tac /home/rohff/bounty.bugs); do php pentest.php DOMAIN "ens3 $i domain4info FALSE";done
        
        //   domain4service
        //cd /home/rohff/WAN ; for i in $(cat /home/rohff/bounty.bugs); do php pentest.php DOMAIN "ens3 $i domain4service FALSE";done
        
        //cd /home/rohff/WAN ; for i in $(tac /home/rohff/bounty.bugs); do php pentest.php DOMAIN "ens3 $i domain4service FALSE";done
        
        
        $params = trim($argv[2]) ;
        list($eth,$domain,$fonction,$flag_poc) = explode(" ", $params);
        $fonction = trim($fonction);
        
        $obj_domain = new DOMAIN($stream,$eth,$domain);
        $obj_domain->poc($flag_poc);
        echo $obj_domain->$fonction();
        break;
        
        
    case "HOST" :
        // for i in $(cat /tmp/wlp5s0.ubisoft.com.hosts | awk '{print $3}'); do php pentest.php HOST "wlp5s0 ubisoft.com $i host4pentest FALSE";done
        // for i in $(tac /tmp/wlp5s0.ubi.com.hosts | awk '{print $3}'); do php pentest.php HOST "wlp5s0 ubi.com $i host4pentest FALSE";done
        $params = trim($argv[2]) ;
        list($eth,$domain,$ip,$fonction,$flag_poc) = explode(" ", $params);
        $obj_ip = new HOST($stream,$eth,$domain,$ip);
        $fonction = trim($fonction);
        $obj_ip->poc($flag_poc);
        $obj_ip->$fonction();
        break;
        
        
    case "IP" :        
        // for i in $(cat /tmp/wlp5s0.ubisoft.com.ips | awk '{print $3}'); do php pentest.php IP "wlp5s0 ubisoft.com $i ip4service FALSE";done
        // for i in $(cat /tmp/wlp5s0.ubi.com.ips | awk '{print $3}'); do php pentest.php IP "wlp5s0 ubis.com $i ip4service FALSE";done
        // for i in 99.84.151.{1..254}; do php pentest.php IP "wlp5s0 ubisoft.com $i ip4service FALSE" ;done 
        $params = trim($argv[2]) ;
        list($eth,$domain,$ip,$fonction,$flag_poc) = explode(" ", $params);  
        $obj_ip = new IP($stream,$eth,$domain,$ip);
        $fonction = trim($fonction);
        $obj_ip->poc($flag_poc);
        $obj_ip->$fonction();
        break;
       
        
    case "PORT" :
        $flag_poc = FALSE ;
        $params = trim($argv[2]) ;
        list($eth,$domain,$ip,$port,$protocol,$fonction,$flag_poc) = explode(" ", $params);
        $fonction = trim($fonction);
        $obj_port = new PORT($stream,$eth,$domain,$ip,$port,$protocol);
        $obj_port->poc($flag_poc);
        $obj_port->$fonction();
        break;
        
        
    case "SERVICE" :
        $params = trim($argv[2]) ;
        list($eth,$domain,$ip,$port,$protocol,$fonction,$flag_poc) = explode(" ", $params);
        $fonction = trim($fonction);
        $obj_service = new SERVICE($stream,$eth,$domain,$ip,$port,$protocol);
        $obj_service->poc($flag_poc);
        $obj_service->$fonction();
        break;
               
        
    case "WEB" :
        $params = trim($argv[2]) ;
        list($eth,$domain,$url,$fonction,$flag_poc) = explode(" ", $params);
        $fonction = trim($fonction);
        $obj_url = new WEB($stream,$eth,$domain,$url);
        $obj_url->poc($flag_poc);
        $obj_url->$fonction();
        break;
        
        
    case "POC" :
        $params = trim($argv[2]) ;
        list($file_path,$fonction2exec) = explode(" ", $params);
        $file_path = trim($file_path);
        $fonction2exec = trim($fonction2exec);
        $obj_url = new POC();
        $obj_url->poc($flag_poc);
        $eth = "ens3";
        $obj_url->run8vps4domain2fork32($file_path,$fonction2exec,$eth);
        break;
        
        
    case "URL" :
        $params = trim($argv[2]) ;
        list($eth,$domain,$url,$fonction,$flag_poc) = explode(" ", $params);
        $fonction = trim($fonction);
        $obj_url = new URL($stream,$eth,$domain,$url);
        $obj_url->poc($flag_poc);
        $obj_url->$fonction();
        break;
                
        
    case "LAN" :
        $params = trim($argv[2]) ;
        $flag_poc = FALSE ;
        //$flag_poc = TRUE ;
        // $whois = "listening Server";
          var_dump($params);
        list($eth,$domain,$ip,$port,$protocol,$lport,$lprotocol,$templateB64_cmd,$templateB64_shell,$type,$timeout,$whois) = explode(" ", $params);
       
        $obj_server = new SERVICE($stream,$eth,$domain,$ip,$port,$protocol);
        $obj_server->poc($flag_poc);
        if (stristr($type, "server")) echo $obj_server->stream8server($lport,$lprotocol,$templateB64_cmd,$templateB64_shell,$whois, $timeout);
        if (stristr($type, "client")) echo $obj_server->stream8client($lport,$lprotocol,$templateB64_cmd,$templateB64_shell,$whois, $timeout);
        break;
        

        
        
    default:
        {echo "Usage: ".__FILE__." '(DOMAIN || HOST || IP || PORT || WEB || URL || LAN || FOR)' 'PARAMS (IP || (PORT + PORT + PROTOCOL) || (SERVICE + PROTOCOL) )' \n";exit(0);}
        break;
}



//$obj_ip->requette("sudo chown -R $obj_ip->user_local:$obj_ip->user_local  $obj_ip->racine");
//echo $obj_ip->ip4pentest();

//$obj_ip->pause();





?>