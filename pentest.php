<?php

include "./core/0.all.inc.php";


/*
 
  docker-compose down && docker rm $(docker ps -a -q)
  
   for i in `seq 172 190` ;do php pentest.php IP "tun0 hackthebox.eu 10.10.10.$i ip4service FALSE" ;done 

  
  
  
 */


$exec = new DATA();


##############################################################################



if ( $argc != 3 ) {echo "Usage: ".__FILE__." 'SERVICE' 'PARAMS' ";exit(0);}

$service = strtoupper(trim($argv[1])) ;
$exec->start("Pentest", $service);

$stream = "";
$flag_poc = FALSE ;

switch ($service){
    
    case "DOMAIN" :
        $params = trim($argv[2]) ;
        list($eth,$domain,$fonction,$flag_poc) = explode(" ", $params);
        $fonction = trim($fonction);
        
        $obj_domain = new DOMAIN($stream,$eth,$domain);
        $obj_domain->poc($flag_poc);
        $obj_domain->article("ETH", $eth);
        $obj_domain->article("DOMAIN", $domain);
        $obj_domain->article("FUNCTION", $fonction);
        $obj_domain->article("FLAG", $flag_poc);
        
        $obj_domain->$fonction();
        break;
        
        
    case "HOST" :
        $params = trim($argv[2]) ;
        list($eth,$domain,$ip,$fonction,$flag_poc) = explode(" ", $params);
        $obj_ip = new HOST($stream,$eth,$domain,$ip);
        $fonction = trim($fonction);
        $obj_ip->poc($flag_poc);
        $obj_ip->$fonction();
        break;
        
        
    case "IP" :        
        $params = trim($argv[2]) ;
        list($eth,$domain,$ip,$fonction,$flag_poc) = explode(" ", $params);  
        $obj_ip = new IP($stream,$eth,$domain,$ip);
        $fonction = trim($fonction);
        $obj_ip->poc($flag_poc);
        $obj_ip->$fonction();
        break;
       
        
    case "PORT" :
        $flag_poc = FALSE ;
        $params = trim($argv[2]) ;
        list($eth,$domain,$ip,$port,$protocol,$fonction,$flag_poc) = explode(" ", $params);
        $fonction = trim($fonction);
        $obj_port = new PORT($stream,$eth,$domain,$ip,$port,$protocol);
        $obj_port->poc($flag_poc);
        $obj_port->$fonction();
        break;
        
        
    case "SERVICE" :
        $params = trim($argv[2]) ;
        list($eth,$domain,$ip,$port,$protocol,$fonction,$flag_poc) = explode(" ", $params);
        $fonction = trim($fonction);
        $obj_service = new SERVICE($stream,$eth,$domain,$ip,$port,$protocol);
        $obj_service->poc($flag_poc);
        $obj_service->$fonction();
        break;
               
        
    case "WEB" :
        $params = trim($argv[2]) ;
        list($eth,$domain,$url,$fonction,$flag_poc) = explode(" ", $params);
        $fonction = trim($fonction);
        $obj_url = new WEB($stream,$eth,$domain,$url);
        $obj_url->poc($flag_poc);
        $obj_url->$fonction();
        break;
        
        
    case "POC" :
        $params = trim($argv[2]) ;
        list($fonction2exec) = explode(" ", $params);
        $fonction2exec = trim($fonction2exec);
        $obj_url = new com4code();
        $obj_url->poc(TRUE);
        $obj_url->$fonction2exec();
        break;
        
        
    case "URL" :
        $params = trim($argv[2]) ;
        list($eth,$domain,$url,$fonction,$flag_poc) = explode(" ", $params);
        $fonction = trim($fonction);
        $obj_url = new URL($stream,$eth,$domain,$url);
        $obj_url->poc($flag_poc);
        $obj_url->$fonction();
        break;
                
        
    case "LAN" :
        $params = trim($argv[2]) ;
        $flag_poc = FALSE ;
        //$flag_poc = TRUE ;
        // $whois = "listening Server";
          var_dump($params);
        list($eth,$domain,$ip,$port,$protocol,$lport,$lprotocol,$templateB64_cmd,$templateB64_shell,$type,$timeout,$whois) = explode(" ", $params);
       
        $obj_server = new SERVICE($stream,$eth,$domain,$ip,$port,$protocol);
        $obj_server->poc($flag_poc);
        if (stristr($type, "server")) echo $obj_server->stream8server($lport,$lprotocol,$templateB64_cmd,$templateB64_shell,$whois, $timeout);
        if (stristr($type, "client")) echo $obj_server->stream8client($lport,$lprotocol,$templateB64_cmd,$templateB64_shell,$whois, $timeout);
        break;
        

        
        
    default:
        {echo "Usage: ".__FILE__." '(DOMAIN || HOST || IP || PORT || WEB || URL || LAN || FOR)' 'PARAMS (IP || (PORT + PORT + PROTOCOL) || (SERVICE + PROTOCOL) )' \n";exit(0);}
        break;
}




?>