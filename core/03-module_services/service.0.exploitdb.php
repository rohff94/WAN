<?php


class service2exploitdb extends service2dns {


    public function __construct($eth,$domain,$ip,$port,$service_protocol,$stream) {
        parent::__construct($eth,$domain,$ip,$port,$service_protocol,$stream);
    }


    
public function service2exploitdb4exec(){
    $this->ssTitre(__FUNCTION__);
    $result = "";
    $exploitdb_rst = array();
    $msf_rst = array();
    
    $exploitdb_rst = $this->service2exploitdb4files4list();
    $result .= $this->tab($exploitdb_rst);
    $this->pause();
    $size_files = count($exploitdb_rst);
   // if ($size_files<=5)
        foreach ($exploitdb_rst as $file_exploit){
            $result .= $this->exploit2file2compile("", "", $file_exploit);
    } 
    $this->pause();
    if (empty($exploitdb_rst)){
    $msf_rst = $this->service2msf4files4list();
    $result .= $this->tab($msf_rst);
    $this->pause();
    $size_files = count($msf_rst);
    if ($size_files<=5)
        foreach ($msf_rst as $exploit){
            $result .= $this->msf2info($exploit);
    } 
    $this->pause();
    }
    if ( ($this->service_name==="http") || ($this->service_name==="https") ) {
        $result .= $this->web4exploits($this->ip, $this->port);
    }
    $this->pause();
    echo $result;
    return $result;
}

public function service2exploitdb4files4list(){
    $this->ssTitre(__FUNCTION__);
    $files_rst = array();
    //if (!file_exists("/usr/bin/searchsploit")) $this->install_exploit_exploitdb();
    if ( ((!empty($this->service_extrainfo)) || (!empty($this->service_product))) && ((!empty($this->service_version)) && (!empty($this->service_name))) ) {
        $search = "$this->service_name $this->service_version $this->service_product $this->service_extrainfo";
        $files_rst += $this->exploitdb($search);
    }
    if (!empty($files_rst)) return array_unique(array_filter($files_rst));
    if ((!empty($this->service_product)) && (!empty($this->service_version)) && (!empty($this->service_name)) )  {
        $search = "$this->service_name $this->service_version $this->service_product";
        $files_rst += $this->exploitdb($search);
    }
    if (!empty($files_rst)) return array_unique(array_filter($files_rst));
    if ((!empty($this->service_version)) && (!empty($this->service_name)) ) {
        $search = "$this->service_name $this->service_version";
        $files_rst += $this->exploitdb($search);
    }
    if (!empty($files_rst)) return array_unique(array_filter($files_rst));
    if ((!empty($this->service_product)) && (!empty($this->service_version)) ) {
        $search = "$this->service_version $this->service_product";
        $files_rst += $this->exploitdb($search);
    }
    if (!empty($files_rst)) return array_unique(array_filter($files_rst));
    if ((!empty($this->service_product)) && (!empty($this->service_name)) ) {
        $search = "$this->service_name $this->service_product";
        $files_rst += $this->exploitdb($search);
    }
    if (!empty($files_rst)) return array_unique(array_filter($files_rst));
    return $files_rst;
}


public function service2msf4files4list(){
    $this->ssTitre(__FUNCTION__);
    $files_rst = array();
    //if (!file_exists("/usr/bin/searchsploit")) $this->install_exploit_exploitdb();
    if ( ((!empty($this->service_extrainfo)) || (!empty($this->service_product))) && ((!empty($this->service_version)) && (!empty($this->service_name))) ) {
        $search = "$this->service_name $this->service_version $this->service_product $this->service_extrainfo";
        $files_rst += $this->msf2search($search);
    }
    if (!empty($files_rst)) return array_unique(array_filter($files_rst));
    if ((!empty($this->service_product)) && (!empty($this->service_version)) && (!empty($this->service_name)) )  {
        $search = "$this->service_name $this->service_version $this->service_product";
        $files_rst += $this->msf2search($search);
    }
    if (!empty($files_rst)) return array_unique(array_filter($files_rst));
    if ((!empty($this->service_version)) && (!empty($this->service_name)) ) {
        $search = "$this->service_name $this->service_version";
         $files_rst += $this->msf2search($search);
    }
    if (!empty($files_rst)) return array_unique(array_filter($files_rst));
    if ((!empty($this->service_product)) && (!empty($this->service_version)) ) {
        $search = "$this->service_version $this->service_product";
        $files_rst += $this->msf2search($search);
    }
    if (!empty($files_rst)) return array_unique(array_filter($files_rst));
    if ((!empty($this->service_product)) && (!empty($this->service_name)) ) {
        $search = "$this->service_name $this->service_product";
        $files_rst += $this->msf2search($search);
    }
    if (!empty($files_rst)) return array_unique(array_filter($files_rst));
    return $files_rst;
}


  }
?>
